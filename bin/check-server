#!/usr/bin/env bash
# Script to check if the Rails server is running

# Function to log messages with timestamps
log() {
  echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1"
}

# Check if the server is running
log "Checking if Rails server is running..."
if curl -s http://localhost:3000/health > /dev/null; then
  log "Rails server is running."
  exit 0
else
  log "Rails server is not running."
  
  # Check if PostgreSQL is running
  log "Checking if PostgreSQL is running..."
  if pg_isready -q; then
    log "PostgreSQL is running."
  else
    log "PostgreSQL is not running. Please start it with: brew services start postgresql@14"
  fi
  
  # Check if Redis is running
  log "Checking if Redis is running..."
  if redis-cli ping > /dev/null 2>&1; then
    log "Redis is running."
  else
    log "Redis is not running. Please start it with: brew services start redis"
  fi
  
  log "Please start the Rails server with: bin/rails-server-simple"
  exit 1
fi
